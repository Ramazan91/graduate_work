{% extends "base.html" %}
{% block content %}

{% if has_today %}
<div class="alert alert-primary shadow-soft mb-4" id="todayBanner">
  ðŸ”” {{ t["you_have_tasks_today"] }}
  <button class="btn btn-sm btn-primary ms-2" id="enableNotify">{{ t["enable_notify"] }}</button>
</div>
<script>
  const btn = document.getElementById('enableNotify');
  if (btn && 'Notification' in window) {
    btn.addEventListener('click', async () => {
      const perm = await Notification.requestPermission();
      if (perm === 'granted') {
        new Notification('{{ t["reminder"] }}', { body: '{{ t["dont_forget_tasks"] }}' });
        document.getElementById('todayBanner').style.display = 'none';
      }
    });
  }
</script>
{% endif %}

<div class="card card-glass mb-3">
  <div class="card-body">
    <form action="{{ url_for('add') }}" method="post" class="row g-2 align-items-start">
      <div class="col-12 col-md-4">
        <input type="text" name="title" class="form-control form-control-dark" placeholder="{{ t['task_title'] }}" required>
      </div>
      <div class="col-12 col-md-5">
        <input type="text" name="description" class="form-control form-control-dark" placeholder="{{ t['task_description'] }}">
      </div>
      <div class="col-8 col-md-2">
        <input type="date" name="due_date" class="form-control form-control-dark" placeholder="{{ t['task_due'] }}">
      </div>
      <div class="col-4 col-md-1 d-grid">
        <button type="submit" class="btn btn-primary">{{ t["add_task"] }}</button>
      </div>
    </form>
  </div>
</div>

<ul class="list-group list-group-flush shadow-soft">
  {% for task in tasks %}
  <li class="list-group-item item-dark d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2">
    <div class="d-flex align-items-start gap-3">
      <div class="status-dot {% if task.complete %}done{% elif is_overdue(task) %}overdue{% elif is_today(task) %}today{% endif %}"></div>
      <div>
        <div class="fw-semibold {% if task.complete %}text-decoration-line-through opacity-75{% endif %}">
          {{ task.title }}
          {% if is_today(task) and not task.complete %}<span class="badge bg-info ms-2">{{ t["today"] }}</span>{% endif %}
          {% if is_overdue(task) %}<span class="badge bg-danger ms-2">{{ t["overdue"] }}</span>{% endif %}
        </div>
        {% if task.description %}
          <div class="text-muted small">{{ task.description }}</div>
        {% endif %}
        {% if task.due_date %}
          <div class="text-muted xsmall">Ð¡Ñ€Ð¾Ðº: {{ task.due_date|human_date }}</div>
        {% endif %}
      </div>
    </div>
    <div class="d-flex gap-2">
      {% if not task.complete %}
        <a href="{{ url_for('complete', task_id=task.id) }}" class="btn btn-success btn-sm">{{ t["complete"] }}</a>
      {% else %}
        <a href="{{ url_for('uncomplete', task_id=task.id) }}" class="btn btn-outline-secondary btn-sm">{{ t["uncomplete"] }}</a>
      {% endif %}
      <a href="{{ url_for('delete', task_id=task.id) }}" class="btn btn-danger btn-sm">ðŸ—‘ {{ t["delete"] }}</a>
    </div>
  </li>
  {% endfor %}
</ul>

{% endblock %}

