{% extends "base.html" %}
{# –ù–∞—Å–ª–µ–¥—É–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω base.html –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (header, footer, —Å—Ç–∏–ª–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã) #}

{% block content %}
{# –ù–∞—á–∞–ª–æ –±–ª–æ–∫–∞ content ‚Äî —Å—é–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã #}

{% if has_today %}
<div class="alert alert-primary shadow-soft mb-4" id="todayBanner">
  üîî {{ t["you_have_tasks_today"] }}
  <button class="btn btn-sm btn-primary ms-2" id="enableNotify">{{ t["enable_notify"] }}</button>
</div>
{# –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (has_today=True):
   - –≤—ã–≤–æ–¥–∏–º –±–∞–Ω–Ω–µ—Ä —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
   - —Ç–µ–∫—Å—Ç –±–µ—Ä—ë–º –∏–∑ —Å–ª–æ–≤–∞—Ä—è t
   - –∫–Ω–æ–ø–∫–∞ "–≤–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" —Å id enableNotify #}

<script>
  const btn = document.getElementById('enableNotify');
  if (btn && 'Notification' in window) {
    btn.addEventListener('click', async () => {
      const perm = await Notification.requestPermission();
      if (perm === 'granted') {
        new Notification('{{ t["reminder"] }}', { body: '{{ t["dont_forget_tasks"] }}' });
        document.getElementById('todayBanner').style.display = 'none';
      }
    });
  }
</script>
{# –°–∫—Ä–∏–ø—Ç:
   - –∏—â–µ–º –∫–Ω–æ–ø–∫—É –ø–æ id
   - –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Notification API
   - –ø–æ –∫–ª–∏–∫—É –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ, —Å–æ–∑–¥–∞—ë–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –∏–∑ —Å–ª–æ–≤–∞—Ä—è t
   - —Å–∫—Ä—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä –ø–æ—Å–ª–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è #}
{% endif %}

<div class="card card-glass mb-3">
  <div class="card-body">
    <form action="{{ url_for('add') }}" method="post" class="row g-2 align-items-start">
      {# –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏:
         - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ route 'add'
         - –º–µ—Ç–æ–¥ POST
         - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã Bootstrap-–∫–ª–∞—Å—Å—ã –¥–ª—è —Å–µ—Ç–∫–∏ –∏ –æ—Ç—Å—Ç—É–ø–æ–≤ #}

      <div class="col-12 col-md-4">
        <input type="text" name="title" class="form-control form-control-dark" placeholder="{{ t['task_title'] }}" required>
      </div>
      {# –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) #}

      <div class="col-12 col-md-5">
        <input type="text" name="description" class="form-control form-control-dark" placeholder="{{ t['task_description'] }}">
      </div>
      {# –ü–æ–ª–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) #}

      <div class="col-8 col-md-2">
        <input type="date" name="due_date" class="form-control form-control-dark" placeholder="{{ t['task_due'] }}">
      </div>
      {# –ü–æ–ª–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ #}

      <div class="col-4 col-md-1 d-grid">
        <button type="submit" class="btn btn-primary">{{ t["add_task"] }}</button>
      </div>
      {# –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É" #}
    </form>
  </div>
</div>

<ul class="list-group list-group-flush shadow-soft">
  {% for task in tasks %}
  <li class="list-group-item item-dark d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2"
      data-due="{{ task.due_date }}"
      data-title="{{ task.title }}">
    {# –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏:
       - –∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —ç—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞
       - data-–∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞—Ç—ã –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ JS) #}

    <div class="d-flex align-items-start gap-3">
      <div class="status-dot {% if task.complete %}done{% elif is_overdue(task) %}overdue{% elif is_today(task) %}today{% endif %}"></div>
      {# –ö—Ä—É–∂–æ–∫-—Å—Ç–∞—Ç—É—Å:
         - –∫–ª–∞—Å—Å done –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
         - –∫–ª–∞—Å—Å overdue –µ—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞
         - –∫–ª–∞—Å—Å today –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è #}

      <div>
        <div class="fw-semibold {% if task.complete %}text-decoration-line-through opacity-75{% endif %}">
          {{ task.title }}
          {% if is_today(task) and not task.complete %}<span class="badge bg-info ms-2">{{ t["today"] }}</span>{% endif %}
          {% if is_overdue(task) %}<span class="badge bg-danger ms-2">{{ t["overdue"] }}</span>{% endif %}
        </div>
        {# –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:
           - –∑–∞—á—ë—Ä–∫–Ω—É—Ç–æ –∏ —Å —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–π –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
           - –¥–æ–±–∞–≤–ª—è–µ–º –±–µ–π–¥–∂ "–°–µ–≥–æ–¥–Ω—è" –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
           - –¥–æ–±–∞–≤–ª—è–µ–º –±–µ–π–¥–∂ "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ" –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ #}

        {% if task.description %}
          <div class="text-muted small">{{ task.description }}</div>
        {% endif %}
        {# –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å #}

        {% if task.due_date %}
          <div class="text-muted xsmall">–°—Ä–æ–∫: {{ task.due_date|human_date }}</div>
        {% endif %}
        {# –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º–∞—è —á–µ—Ä–µ–∑ —Ñ–∏–ª—å—Ç—Ä human_date #}
      </div>
    </div>

    <div class="d-flex gap-2">
      {% if not task.complete %}
        <a href="{{ url_for('complete', task_id=task.id) }}" class="btn btn-success btn-sm">{{ t["complete"] }}</a>
      {% else %}
        <a href="{{ url_for('uncomplete', task_id=task.id) }}" class="btn btn-outline-secondary btn-sm">{{ t["uncomplete"] }}</a>
      {% endif %}
      {# –ö–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è/–æ—Ç–º–µ–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:
         - –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –∫–Ω–æ–ø–∫–∞ "–í—ã–ø–æ–ª–Ω–∏—Ç—å"
         - –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é" #}

      <a href="{{ url_for('delete', task_id=task.id) }}" class="btn btn-danger btn-sm">üóë {{ t["delete"] }}</a>
      {# –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ #}
    </div>
  </li>
  {% endfor %}
</ul>

{% endblock %}
{# –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ content #}
