{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="m-0">Календарь — {{ month_name }} {{ year }}</h2>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-light btn-sm"
       href="{{ url_for('calendar_view', year=(month == 1 and year-1 or year), month=(month == 1 and 12 or month-1)) }}">← Пред</a>
    <a class="btn btn-light btn-sm"
       href="{{ url_for('calendar_view', year=today.year, month=today.month) }}">Сегодня</a>
    <a class="btn btn-outline-light btn-sm"
       href="{{ url_for('calendar_view', year=(month == 12 and year+1 or year), month=(month == 12 and 1 or month+1)) }}">След →</a>
  </div>
</div>

<div class="calendar-grid">
  <div class="calendar-head">Пн</div>
  <div class="calendar-head">Вт</div>
  <div class="calendar-head">Ср</div>
  <div class="calendar-head">Чт</div>
  <div class="calendar-head">Пт</div>
  <div class="calendar-head">Сб</div>
  <div class="calendar-head">Вс</div>

  {% for week in cal %}
    {% for day in week %}
      {% if day == 0 %}
        <div class="calendar-cell empty"></div>
      {% else %}
        {% set key = "%04d-%02d-%02d"|format(year, month, day) %}
        {% set items = by_date.get(key, []) %}
        <div class="calendar-cell {% if today.year==year and today.month==month and today.day==day %}today{% endif %}">
          <div class="calendar-day">{{ day }}</div>
          {% for t in items %}
            <div class="calendar-item {% if t.complete %}done{% endif %}">
              {{ t.title }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>

{% endblock %}
